"use strict";(self.webpackChunklukso_docs=self.webpackChunklukso_docs||[]).push([[964],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),d=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=d(e.components);return a.createElement(i.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=d(n),m=r,k=p["".concat(i,".").concat(m)]||p[m]||u[m]||s;return n?a.createElement(k,o(o({ref:t},c),{},{components:n})):a.createElement(k,o({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=p;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var d=2;d<s;d++)o[d]=n[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},8215:function(e,t,n){var a=n(7294);t.Z=function(e){var t=e.children,n=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",hidden:n,className:r},t)}},5064:function(e,t,n){n.d(t,{Z:function(){return p}});var a=n(7462),r=n(7294),s=n(2389),o=n(9443);var l=function(){var e=(0,r.useContext)(o.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},i=n(3039),d=n(6010),c="tabItem_1uMI";function u(e){var t,n,a,s=e.lazy,o=e.block,u=e.defaultValue,p=e.values,m=e.groupId,k=e.className,h=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),f=null!=p?p:h.map((function(e){var t=e.props;return{value:t.value,label:t.label}})),g=(0,i.lx)(f,(function(e,t){return e.value===t.value}));if(g.length>0)throw new Error('Docusaurus error: Duplicate values "'+g.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var b=null===u?u:null!=(t=null!=u?u:null==(n=h.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(a=h[0])?void 0:a.props.value;if(null!==b&&!f.some((function(e){return e.value===b})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+b+'" but none of its children has the corresponding value. Available values are: '+f.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var v=l(),y=v.tabGroupChoices,N=v.setTabGroupChoices,w=(0,r.useState)(b),S=w[0],A=w[1],E=[],P=(0,i.o5)().blockElementScrollPositionUntilNextRender;if(null!=m){var x=y[m];null!=x&&x!==S&&f.some((function(e){return e.value===x}))&&A(x)}var T=function(e){var t=e.currentTarget,n=E.indexOf(t),a=f[n].value;a!==S&&(P(t),A(a),null!=m&&N(m,a))},C=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a=E.indexOf(e.currentTarget)+1;n=E[a]||E[0];break;case"ArrowLeft":var r=E.indexOf(e.currentTarget)-1;n=E[r]||E[E.length-1]}null==(t=n)||t.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,d.Z)("tabs",{"tabs--block":o},k)},f.map((function(e){var t=e.value,n=e.label;return r.createElement("li",{role:"tab",tabIndex:S===t?0:-1,"aria-selected":S===t,className:(0,d.Z)("tabs__item",c,{"tabs__item--active":S===t}),key:t,ref:function(e){return E.push(e)},onKeyDown:C,onFocus:T,onClick:T},null!=n?n:t)}))),s?(0,r.cloneElement)(h.filter((function(e){return e.props.value===S}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},h.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==S})}))))}function p(e){var t=(0,s.Z)();return r.createElement(u,(0,a.Z)({key:String(t)},e))}},9443:function(e,t,n){var a=(0,n(7294).createContext)(void 0);t.Z=a},7937:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return d},contentTitle:function(){return c},metadata:function(){return u},toc:function(){return p},default:function(){return k}});var a=n(7462),r=n(3366),s=(n(7294),n(3905)),o=n(5064),l=n(8215),i=["components"],d={sidebar_position:3},c="LSP6-KeyManager",u={unversionedId:"standards/LSP6-KeyManager",id:"standards/LSP6-KeyManager",isDocsHomePage:!1,title:"LSP6-KeyManager",description:"Key Manager flow chart",source:"@site/docs/standards/LSP6-KeyManager.md",sourceDirName:"standards",slug:"/standards/LSP6-KeyManager",permalink:"/standards/LSP6-KeyManager",editUrl:"https://github.com/lukso-network/docs/tree/main/docs/standards/LSP6-KeyManager.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"standardsSidebar",previous:{title:"Universal Profiles",permalink:"/standards/Universal-Profiles"},next:{title:"NFT2.0",permalink:"/standards/NFT2.0"}},p=[{value:'<a name="types-of-permissions"></a> Types of permissions',id:"-types-of-permissions",children:[{value:'<a name="permissions-value"></a> Permission values',id:"-permission-values",children:[],level:3},{value:'<a name="allowed-addresses"></a> Allowed addresses',id:"-allowed-addresses",children:[],level:3},{value:'<a name="allowed-functions"></a> Allowed functions',id:"-allowed-functions",children:[],level:3}],level:2},{value:"Permission Keys",id:"permission-keys",children:[],level:2},{value:"Setting permissions",id:"setting-permissions",children:[],level:2},{value:"References",id:"references",children:[],level:2}],m={toc:p};function k(e){var t=e.components,n=(0,r.Z)(e,i);return(0,s.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"lsp6-keymanager"},"LSP6-KeyManager"),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/31145285/129574099-9eba52d4-4f82-4f11-8ac5-8bfa18ce97d6.jpeg",alt:"Key Manager flow chart"})),(0,s.kt)("p",null,"An ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-0-ERC725Account.md"},"ERC725Account")," on its own comes with limited usability. Since it is an ",(0,s.kt)("strong",{parentName:"p"},"owned contract"),", only the Account's owner can write data into it, or use it to interact with other smart contracts."),(0,s.kt)("p",null,"Here comes the Key Manager. It is a smart contract that controls an ERC725Account, acting as its new owner. It then functions as a gateway for an ERC725Account."),(0,s.kt)("p",null,"The idea is to give ",(0,s.kt)("a",{parentName:"p",href:"#types-of-permissions"},"permissions")," to any ",(0,s.kt)("inlineCode",{parentName:"p"},"address"),", like Externally Owned Accounts (EOA) or smart contracts. These can then interact with an ",(0,s.kt)("strong",{parentName:"p"},"ERC725Account")," through the Key Manager. On each interaction, the Key Manager will allow or restrict access, based on the permissions set for the calling ",(0,s.kt)("inlineCode",{parentName:"p"},"address"),"."),(0,s.kt)("p",null,"\u274c ","\xa0"," ",(0,s.kt)("strong",{parentName:"p"},"Without a Key Manager"),", only the ERC725Account's owner can use its Account."),(0,s.kt)("p",null,"\u2705 ","\xa0"," ",(0,s.kt)("strong",{parentName:"p"},"With a Key Manager")," attached to an ERC725Account, other addresses (EOAs or contracts) can use an Account on behalf of its owner."),(0,s.kt)("p",null,"Permissions for an ",(0,s.kt)("inlineCode",{parentName:"p"},"address")," are stored inside the key-value store of the ERC725Account contract, under specific keys listed below."),(0,s.kt)("table",null,(0,s.kt)("thead",{parentName:"table"},(0,s.kt)("tr",{parentName:"thead"},(0,s.kt)("th",{parentName:"tr",align:null},"Permission Type"),(0,s.kt)("th",{parentName:"tr",align:"left"},"Key"))),(0,s.kt)("tbody",{parentName:"table"},(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},(0,s.kt)("a",{parentName:"td",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-6-KeyManager.md#addresspermissionspermissionsaddress"},"Address Permissions")),(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"0x4b80742d0000000082ac0000<address>"))),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},(0,s.kt)("a",{parentName:"td",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-6-KeyManager.md#addresspermissionsallowedaddressesaddress"},"Allowed Addresses")),(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"0x4b80742d00000000c6dd0000**<address>"))),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},(0,s.kt)("a",{parentName:"td",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-6-KeyManager.md#addresspermissionsallowedfunctionsaddress"},"Allowed Functions")),(0,s.kt)("td",{parentName:"tr",align:"left"},(0,s.kt)("inlineCode",{parentName:"td"},"0x4b80742d000000008efe0000<address>"))))),(0,s.kt)("hr",null),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("a",{parentName:"p",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-6-KeyManager.md#erc725y-keys"},"See LSP6 for more details"))),(0,s.kt)("br",null),"Since permissions are stored under the ERC725Account contract, they are not attached to the Key Manager itself. The Key Manager can then easily be upgraded without the need to set all the permissions again.",(0,s.kt)("hr",null),(0,s.kt)("h2",{id:"-types-of-permissions"},(0,s.kt)("a",{name:"types-of-permissions"})," Types of permissions"),(0,s.kt)("p",null,"There are 3 main types of permissions that can be set for addresses interacting with a Universal Profile."),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},(0,s.kt)("a",{parentName:"p",href:"#permissions-value"},(0,s.kt)("strong",{parentName:"a"},"Address Permissions")),": defines a set of ",(0,s.kt)("strong",{parentName:"p"},"permission values")," for an ",(0,s.kt)("inlineCode",{parentName:"p"},"address"),".")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},(0,s.kt)("a",{parentName:"p",href:"#allowed-addresses"},(0,s.kt)("strong",{parentName:"a"},"Allowed Addresses:"))," defines which EOA or contract addresses an ",(0,s.kt)("inlineCode",{parentName:"p"},"address")," is allowed to interact with.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},(0,s.kt)("a",{parentName:"p",href:"#allowed-functions"},(0,s.kt)("strong",{parentName:"a"},"Allowed Functions:"))," defines which function selectors an ",(0,s.kt)("inlineCode",{parentName:"p"},"address")," is allowed to run on a specific contract."))),(0,s.kt)("h3",{id:"-permission-values"},(0,s.kt)("a",{name:"permissions-value"})," Permission values"),(0,s.kt)("p",null,"The following default permissions can be set for any address. They are listed in the table below, according to their importance."),(0,s.kt)("p",null,"You can find ",(0,s.kt)("strong",{parentName:"p"},"more details about each permissions by clicking on the toggles below"),"."),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("code",null,"CHANGEOWNER")," - Allows changing the owner of the controlled contract"),(0,s.kt)("p",{style:{marginBottom:"3%",marginTop:"2%",textAlign:"center"}},(0,s.kt)("b",null,"value = "),(0,s.kt)("code",null,"0x0000000000000000000000000000000000000000000000000000000000000001")),(0,s.kt)("p",null,"Enables to change the owner of the linked ERC725Account."),(0,s.kt)("p",null,"Using this permission, you can easily upgrade the ",(0,s.kt)("code",null,"KeyManager")," attached to the Account by transferring ownership to a new ",(0,s.kt)("code",null,"KeyManagerV2"),".")),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("code",null,"CHANGEPERMISSIONS")," - Allows changing of permissions of addresses (adding + removing)"),(0,s.kt)("p",{style:{marginBottom:"3%",marginTop:"2%",textAlign:"center"}},(0,s.kt)("b",null,"value = "),(0,s.kt)("code",null,"0x0000000000000000000000000000000000000000000000000000000000000002")),(0,s.kt)("p",null,"This permission allows an address to ",(0,s.kt)("b",null,"grant + revoke")," permissions for any specific address (including itself).")),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("code",null,"ADDPERMISSIONS")," - Allows adding new permissions to addresses"),(0,s.kt)("p",{style:{marginBottom:"3%",marginTop:"2%",textAlign:"center"}},(0,s.kt)("b",null,"value = "),(0,s.kt)("code",null,"0x0000000000000000000000000000000000000000000000000000000000000004")),(0,s.kt)("p",null,"This permission allows an address to ",(0,s.kt)("b",null,"grant ",(0,s.kt)("span",{style:{color:"red"}},"(but not revoke)"))," permissions for any specific address (including itself).")),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("code",null,"SETDATA")," - Allows setting data on the controlled contract"),(0,s.kt)("p",{style:{marginBottom:"3%",marginTop:"2%",textAlign:"center"}},(0,s.kt)("b",null,"value = "),(0,s.kt)("code",null,"0x0000000000000000000000000000000000000000000000000000000000000008")),"Allows an address to write any form of data in the ",(0,s.kt)("a",{href:"https://**github**.com/ethereum/EIPs/blob/master/EIPS/eip-725.md#erc725y"},"ERC725Y")," key-value store of the linked `ERC725Account` (except permissions, that requires the permissions ",(0,s.kt)("code",null,"CHANGEPERMISSIONS")," described above)."),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("code",null,"CALL"),", ",(0,s.kt)("code",null,"STATICCALL")," - Allows calling other contracts through the controlled contract"),(0,s.kt)("p",{style:{marginBottom:"3%",marginTop:"2%",textAlign:"center"}},(0,s.kt)("b",null,"value for CALL = "),(0,s.kt)("code",null,"0x0000000000000000000000000000000000000000000000000000000000000010"),(0,s.kt)("br",null),(0,s.kt)("b",null,"value for STATICCALL = "),(0,s.kt)("code",null,"0x0000000000000000000000000000000000000000000000000000000000000020")),(0,s.kt)("p",null,"This permission enables anyone to use the ERC725Account linked to Key Manager to make external calls (to contracts or Externally Owned Accounts)"),(0,s.kt)("p",null,"The difference between ",(0,s.kt)("code",null,"CALL")," and ",(0,s.kt)("a",{href:"https://eips.ethereum.org/EIPS/eip-214"},(0,s.kt)("code",null,"STATICCALL"))," is that ",(0,s.kt)("b",null,"staticcall")," disallows state change at the target contract."),(0,s.kt)("blockquote",null,"If any state is changed at a target contract through a ",(0,s.kt)("code",null,"STATICCALL"),", the call will revert.")),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("code",null,"DELEGATECALL")," - Allows delegate calling other contracts through the controlled contract"),(0,s.kt)("p",{style:{marginBottom:"3%",marginTop:"2%",textAlign:"center"}},(0,s.kt)("b",null,"value = "),(0,s.kt)("code",null,"0x0000000000000000000000000000000000000000000000000000000000000040")),(0,s.kt)("blockquote",null,"This call type is currently disallowed. See note below for more details.")),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("code",null,"DEPLOY")," - Allows deploying other contracts through the controlled contract"),(0,s.kt)("p",{style:{marginBottom:"3%",marginTop:"2%",textAlign:"center"}},(0,s.kt)("b",null,"value = "),(0,s.kt)("code",null,"0x0000000000000000000000000000000000000000000000000000000000000080")),(0,s.kt)("p",null,"Enables the caller to deploy a smart contract, using the linked ERC725Account as a deployer. The bytecode of the contract to be deployed should be provided in the payload (abi-encoded) passed to the Key Manager."),(0,s.kt)("blockquote",null,"Both the ",(0,s.kt)("code",null,"CREATE")," or ",(0,s.kt)("a",{href:"https://eips.ethereum.org/EIPS/eip-1014"},(0,s.kt)("code",null,"CREATE2"))," opcode can be used to deploy the contract.")),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("code",null,"TRANSFERVALUE")," - Allows transfering value to other contracts from the controlled contract"),(0,s.kt)("p",{style:{marginBottom:"3%",marginTop:"2%",textAlign:"center"}},(0,s.kt)("b",null,"value = "),(0,s.kt)("code",null,"0x0000000000000000000000000000000000000000000000000000000000000100")),"Enables to send native currency from the linked ERC725Account to any address.",(0,s.kt)("br",null),(0,s.kt)("br",null),(0,s.kt)("blockquote",null,"NB: for a simple native token transfer, no data (",(0,s.kt)("code",null,'""'),") should be passed to the fourth parameter of the ",(0,s.kt)("code",null,"execute")," function of the Account contract.",(0,s.kt)("br",null),"For instance: ",(0,s.kt)("code",null,'account.execute(operationCall, recipient, amount, "")'))),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("code",null,"SIGN"),": Allows signing on behalf of the controlled account, for example for login purposes"),(0,s.kt)("p",{style:{marginBottom:"3%",marginTop:"2%",textAlign:"center"}},(0,s.kt)("b",null,"value = "),(0,s.kt)("code",null,"0x0000000000000000000000000000000000000000000000000000000000000200")),"The ",(0,s.kt)("code",null,"SIGN")," permission can be used for keys to sign login messages. It is mostly for web2.0 apps to know which key SHOULD sign."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Permissions can be combined together"),", if an address needs to hold more than one permission."),(0,s.kt)("p",null,"Simply calculate the sum of their decimal value, and convert the result back into hexadecimal. For instance:"),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("a",{parentName:"p",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-6-KeyManager.md#permission-values-in-addresspermissionspermissionsaddress"},"See LSP6 Specs for more details"))),(0,s.kt)(o.Z,{mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"example1",label:"Example 1",default:!0,mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-solidity"},"permissions: CALL + TRANSFERVALUE\n\n  0x0000000000000000000000000000000000000000000000000000000000000010 (16 in decimal)\n+ 0x0000000000000000000000000000000000000000000000000000000000000100 (256)\n---------------------------------------------------------------------\n= 0x0000000000000000000000000000000000000000000000000000000000000110 (= 272)\n"))),(0,s.kt)(l.Z,{value:"example2",label:"Example 2",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-solidity"},"permissions: CHANGEPERMISSIONS + SETDATA\n\n  0x0000000000000000000000000000000000000000000000000000000000000002 (2 in decimal)\n+ 0x0000000000000000000000000000000000000000000000000000000000000008 (8)\n---------------------------------------------------------------------\n= 0x000000000000000000000000000000000000000000000000000000000000000a (= 10)\n")))),(0,s.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"When deployed with our ",(0,s.kt)("a",{parentName:"p",href:"https://docs.lukso.tech/tools/lsp-factoryjs/introduction/getting-started/"},(0,s.kt)("strong",{parentName:"a"},"lsp-factory")," tool"),", the Universal Profile owner will have all the permissions above set by default."))),(0,s.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"Each permission MUST be:"),(0,s.kt)("ul",{parentName:"div"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"exactly 32 bytes long")),(0,s.kt)("li",{parentName:"ul"},"zero left-padded",(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"So \u2705 ",(0,s.kt)("inlineCode",{parentName:"li"},"0x0000000000000000000000000000000000000000000000000000000000000008")),(0,s.kt)("li",{parentName:"ul"},"Not \u274c ",(0,s.kt)("inlineCode",{parentName:"li"},"0x0800000000000000000000000000000000000000000000000000000000000000"))))),(0,s.kt)("p",{parentName:"div"},"For instance, if you try to set the permission SETDATA for an address as ",(0,s.kt)("inlineCode",{parentName:"p"},"0x08"),", this will be stored internally as ",(0,s.kt)("inlineCode",{parentName:"p"},"0x0800000000000000000000000000000000000000000000000000000000000000"),", and will cause incorrect behaviour with odd revert messages."))),(0,s.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"danger")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("inlineCode",{parentName:"strong"},"DELEGATECALL"))," is currently disallowed (even if set on the KeyManager) because of its dangerous nature, as some malicious code can be executed in the context of the linked Account contract."))),(0,s.kt)("h3",{id:"-allowed-addresses"},(0,s.kt)("a",{name:"allowed-addresses"})," Allowed addresses"),(0,s.kt)("p",null,"You can restrict an address to interact only with specific contracts or EOAs."),(0,s.kt)("p",null,"To restrict an ",(0,s.kt)("inlineCode",{parentName:"p"},"<address>")," to only talk to a specific contract at address ",(0,s.kt)("inlineCode",{parentName:"p"},"<target-contract-address>"),", the key-value pair below can be set in the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/ethereum/EIPs/blob/master/EIPS/eip-725.md#erc725y"},"ERC725Y")," contract storage."),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"key:")," ",(0,s.kt)("inlineCode",{parentName:"li"},"0x4b80742d00000000c6dd0000<address>")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"value:")," ",(0,s.kt)("inlineCode",{parentName:"li"},"<target-contract-address>"))),(0,s.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Infos")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},(0,s.kt)("strong",{parentName:"p"},"If no addresses are set, interacting with any address is allowed (= all addresses are whitelisted).")))),(0,s.kt)("h3",{id:"-allowed-functions"},(0,s.kt)("a",{name:"allowed-functions"})," Allowed functions"),(0,s.kt)("p",null,"You can also restrict which functions a specific address can run, by providing a list of ",(0,s.kt)("inlineCode",{parentName:"p"},"bytes4")," function selector."),(0,s.kt)("p",null,"To restrict an ",(0,s.kt)("inlineCode",{parentName:"p"},"<address>")," to only execute the function ",(0,s.kt)("inlineCode",{parentName:"p"},"transfer(address,uint256)")," (selector: ",(0,s.kt)("inlineCode",{parentName:"p"},"a9059cbb"),"), the following key-value pair can be set in the ERC725Y contract storage."),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"key:")," ",(0,s.kt)("inlineCode",{parentName:"li"},"0x4b80742d000000008efe0000<address>")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"value:")," ",(0,s.kt)("inlineCode",{parentName:"li"},"0xa9059cbb"))),(0,s.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Infos")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},(0,s.kt)("strong",{parentName:"p"},"If no bytes4 selectors are set, the caller address can execute any functions.")))),(0,s.kt)("hr",null),(0,s.kt)("h2",{id:"permission-keys"},"Permission Keys"),(0,s.kt)("p",null,"Below is a list of ERC725Y Permission Keys related to the Key Manager.\nWe will store these values in a file ",(0,s.kt)("inlineCode",{parentName:"p"},"constants.js"),", and reuse them through the next code snippets."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'// file: constants.js\n\n// keccak256(\'AddressPermissions[]\')\nconst PERMISSIONS_ARRAY = "0xdf30dba06db6a30e65354d9a64c609861f089545ca58c6b4dbe31a5f338cb0e3";\n\n// prettier-ignore\nconst ADDRESSES = {\n  PERMISSIONS:      "0x4b80742d0000000082ac0000", // AddressPermissions:Permissions:<address> --\x3e bytes32\n  ALLOWEDADDRESSES: "0x4b80742d00000000c6dd0000", // AddressPermissions:AllowedAddresses:<address> --\x3e address[]\n  ALLOWEDFUNCTIONS: "0x4b80742d000000008efe0000", // AddressPermissions:AllowedFunctions:<address> --\x3e bytes4[]\n}\n\n// prettier-ignore\nconst PERMISSIONS = {\n  CHANGEOWNER:      "0x0000000000000000000000000000000000000000000000000000000000000001", // 0000 0000 0000 0001\n  CHANGEPERMISSIONS:"0x0000000000000000000000000000000000000000000000000000000000000002", // .... .... .... 0010\n  ADDPERMISSIONS:   "0x0000000000000000000000000000000000000000000000000000000000000004", // .... .... .... 0100\n  SETDATA:          "0x0000000000000000000000000000000000000000000000000000000000000008", // .... .... .... 1000\n  CALL:             "0x0000000000000000000000000000000000000000000000000000000000000010", // .... .... 0001 ....\n  STATICCALL:       "0x0000000000000000000000000000000000000000000000000000000000000020", // .... .... 0010 ....\n  DELEGATECALL:     "0x0000000000000000000000000000000000000000000000000000000000000040", // .... .... 0100 ....\n  DEPLOY:           "0x0000000000000000000000000000000000000000000000000000000000000080", // .... .... 1000 ....\n  TRANSFERVALUE:    "0x0000000000000000000000000000000000000000000000000000000000000100", // .... 0001 .... ....\n  SIGN:             "0x0000000000000000000000000000000000000000000000000000000000000200", // .... 0010 .... ....\n}\n\nmodule.exports = {\n  ADDRESSES,\n  PERMISSIONS,\n  PERMISSIONS_ARRAY,\n};\n')),(0,s.kt)("hr",null),(0,s.kt)("h2",{id:"setting-permissions"},"Setting permissions"),(0,s.kt)("p",null,"The code snippets below show how to set permissions for ",(0,s.kt)("strong",{parentName:"p"},"Bob")," on a Universal Profile owned by ",(0,s.kt)("inlineCode",{parentName:"p"},"yourEOA"),".\nIt assumes that the profile has been deployed with our ",(0,s.kt)("a",{parentName:"p",href:"https://docs.lukso.tech/tools/lsp-factoryjs/introduction/getting-started"},"lsp-factory.js")," tool."),(0,s.kt)(o.Z,{mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"web3js",label:"web3.js",default:!0,mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'// see file above constants.js\nconst { ADDRESSES, PERMISSIONS, PERMISSIONS_ARRAY } = require("./constants");\n\nconst UniversalProfile = require("@lukso/universalprofile-smart-contracts/build/artifacts/UniversalProfile.json");\nconst KeyManager = require("@lukso/universalprofile-smart-contracts/build/artifacts/KeyManager.json");\n\nconst universalProfile = new web3.eth.Contract(UniversalProfile.abi, "<your-UniversalProfile-address>");\nconst keyManager = new web3.eth.Contract(KeyManager.abi, "<your-KeyManager-Address>");\n\nlet bobAddress = "0xcafecafecafecafecafecafecafecafecafecafe";\nlet bobPermissions = PERMISSIONS.SETDATA;\n\n// give the permission SETDATA to Bob\nasync function setBobPermission() {\n  let payload = await universalProfile.methods\n    .setData(\n      [\n        ADDRESSES.PERMISSIONS + bobAddress.substr(2), // allow Bob to setData on your UP\n        PERMISSIONS_ARRAY, // length of AddressPermissions[]\n        PERMISSIONS_ARRAY.slice(0, 34) + "00000000000000000000000000000001", // add Bob\'s address into the list of permissions\n      ],\n      [\n        bobPermissions,\n        3, // 3 because UP owner + Universal Receiver Delegate permission have already been set by lsp-factory\n        bobAddress,\n      ]\n    )\n    .encodeABI();\n\n  keyManager.execute(payload).send({ from: "<your-eoa-address>", gas: 300_000 });\n}\n\nsetBobPermission();\n'))),(0,s.kt)(l.Z,{value:"etherjs",label:"ether.js",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'// see file above constants.js\nconst { ADDRESSES, PERMISSIONS, PERMISSIONS_ARRAY } = require("./constants");\n\nconst UniversalProfile = require("@lukso/universalprofile-smart-contracts/build/artifacts/UniversalProfile.json");\nconst KeyManager = require("@lukso/universalprofile-smart-contracts/build/artifacts/KeyManager.json");\n\nconst universalProfile = new ethers.Contract("<your-UniversalProfile-address>", UniversalProfile.abi);\nconst keyManager = new ethers.Contract("<your-KeyManager-Address>", KeyManager.abi);\n\nlet bobAddress = "0xcafecafecafecafecafecafecafecafecafecafe";\nlet bobPermissions = ethers.utils.hexZeroPad(PERMISSIONS.SETDATA, 32);\n\n// give the permission SETDATA to Bob\nasync function setBobPermission() {\n  let payload = universalProfile.interface.encodeFunctionData("setData", [\n    [\n      ADDRESSES.PERMISSIONS + bobAddress.substr(2),\n      PERMISSIONS_ARRAY, // length of AddressPermissions[]\n      PERMISSIONS_ARRAY.slice(0, 34) + "00000000000000000000000000000001", // add Bob\'s address into the list of\n    ],\n    [\n      bobPermissions,\n      3, // 3 because UP owner + Universal Receiver Delegate permission have already been set by lsp-factory\n      bobAddress,\n    ],\n  ]);\n\n  await keyManager.connect(yourEOA).execute(payload); // yourEOA should be of type Signer\n}\n\nsetBobPermission();\n')))),(0,s.kt)("h2",{id:"references"},"References"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-6-KeyManager.md"},"LUKSO Standards Proposals: LSP6 - Key Manager (Standard Specification, GitHub)")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/lukso-network/lsp-universalprofile-smart-contracts/tree/develop/contracts/LSP6-KeyManager"},"LSP6 KeyManager: Solidity implementations (GitHub)"))))}k.isMDXComponent=!0}}]);